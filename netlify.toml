[build]
  publish = "client/build"
  command = "npm ci --legacy-peer-deps && npm run install:all && cd client && npm run build && cd ../netlify/functions && npm install"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"
  NPM_VERSION = "9"
  CI = "true"

[[redirects]]
  from = "/api/health"
  to = "/.netlify/functions/health-check"
  status = 200

[[redirects]]
  from = "/api/health-check"
  to = "/.netlify/functions/health-check"
  status = 200

[[redirects]]
  from = "/api/registration-status"
  to = "/.netlify/functions/registration-status-minimal"
  status = 200

[[redirects]]
  from = "/api/login"
  to = "/.netlify/functions/login-minimal"
  status = 200

[[redirects]]
  from = "/api/register"
  to = "/.netlify/functions/register"
  status = 200

[[redirects]]
  from = "/api/users"
  to = "/.netlify/functions/users"
  status = 200

[[redirects]]
  from = "/api/messages/*"
  to = "/.netlify/functions/messages-conversation/:splat"
  status = 200

[[redirects]]
  from = "/api/message"
  to = "/.netlify/functions/message"
  status = 200

[[redirects]]
  from = "/api/messages"
  to = "/.netlify/functions/messages"
  status = 200

[[redirects]]
  from = "/api/conversation/*"
  to = "/.netlify/functions/conversation"
  status = 200

[[redirects]]
  from = "/api/security/info"
  to = "/.netlify/functions/security-info"
  status = 200

[[redirects]]
  from = "/api/system/status"
  to = "/.netlify/functions/system-status"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
